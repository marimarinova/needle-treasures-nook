<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-M7GEBPRY0Z"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-M7GEBPRY0Z');
    </script>
    
    <!-- Primary Meta Tags -->
    <title>Free DMC Inventory Tool | Needle Treasures Nook</title>
    <meta name="title" content="Free DMC Inventory Tool | Needle Treasures Nook">
    <meta name="description" content="Free online DMC thread inventory manager. Track your floss collection, check pattern requirements, find similar colors, and generate shopping lists. Works offline!">
    <meta name="keywords" content="DMC thread checker, floss inventory, cross stitch thread organizer, DMC color chart, thread collection tracker, embroidery floss manager, DMC shopping list, pattern thread checker">
    <meta name="author" content="Marieta - Needle Treasures Nook">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://needletreasuresnook.com/thread-checker.html">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://needletreasuresnook.com/thread-checker.html">
    <meta property="og:title" content="Free DMC Inventory Tool">
    <meta property="og:description" content="Track your DMC thread collection, check pattern requirements, and generate shopping lists. Free tool for cross-stitchers!">
    <meta property="og:image" content="https://needletreasuresnook.com/images/thread-checker-og.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Needle Treasures Nook">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://needletreasuresnook.com/thread-checker.html">
    <meta name="twitter:title" content="Free DMC Inventory Tool">
    <meta name="twitter:description" content="Track your DMC thread collection, check pattern requirements, and generate shopping lists. Free tool for cross-stitchers!">
    <meta name="twitter:image" content="https://needletreasuresnook.com/images/thread-checker-og.jpg">
    
    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "DMC Inventory Tool",
        "url": "https://needletreasuresnook.com/thread-checker.html",
        "description": "Free online tool to track your DMC thread collection, check pattern requirements, find similar colors, and generate shopping lists.",
        "applicationCategory": "UtilitiesApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "author": {
            "@type": "Organization",
            "name": "Needle Treasures Nook",
            "url": "https://needletreasuresnook.com"
        },
        "featureList": [
            "Track DMC thread inventory",
            "Check pattern thread requirements",
            "Find similar DMC colors",
            "Generate shopping lists",
            "Export to PDF",
            "Works offline"
        ]
    }
    </script>
    
    <!-- FAQ Schema for better search results -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "How do I track my DMC thread collection?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Click on any thread color to add it to your collection. Use the + and - buttons to adjust quantities. Your data is saved automatically in your browser."
                }
            },
            {
                "@type": "Question",
                "name": "Can I check what threads I need for a pattern?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Yes! Paste your pattern's thread list in the Pattern Checker tab. The tool will show which threads you have and which you need to buy."
                }
            },
            {
                "@type": "Question",
                "name": "Does the DMC Inventory Tool work offline?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Yes! Once loaded, the tool works offline. Your thread collection data is stored locally on your device."
                }
            }
        ]
    }
    </script>
    
    <!-- PDF.js Library for PDF parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="icon-96x96.png">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#C67B5C">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=Lato:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --terracotta: #C67B5C;
            --terracotta-dark: #A85D40;
            --cream: #F5F0E8;
            --cream-dark: #EDE6DA;
            --sage: #8B9D83;
            --sage-dark: #6F8066;
            --brown: #6B5345;
            --taupe: #B8A99A;
            --white: #FDFCFA;
            --text-dark: #3D3028;
            --text-medium: #5C4D42;
            --text-light: #7A6B5E;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Lato', sans-serif;
            background: var(--cream);
            color: var(--text-dark);
            line-height: 1.5;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--terracotta) 0%, var(--terracotta-dark) 100%);
            color: white;
            padding: 0.5rem 1rem;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.5rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .home-link {
            display: flex;
            align-items: center;
            text-decoration: none;
            opacity: 0.95;
            transition: opacity 0.2s;
        }
        .home-link:hover {
            opacity: 1;
        }
        
        .header-logo {
            height: 32px;
            width: auto;
            filter: brightness(0) invert(1);
        }

        .header-center {
            display: flex;
            gap: 0.75rem;
            font-size: 0.75rem;
            opacity: 0.9;
            margin-left: auto;
        }
        .header-center span { font-weight: 600; }

        .header-right {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .install-btn {
            background: white;
            color: var(--terracotta);
            border: none;
            padding: 0.35rem 0.65rem;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .install-btn:hover {
            background: var(--cream);
            transform: scale(1.05);
        }

        /* Sync Button */
        .sync-btn {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 15px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .sync-btn:hover {
            background: rgba(255,255,255,0.25);
        }
        .sync-btn svg {
            width: 14px;
            height: 14px;
        }
        .sync-btn.synced {
            background: rgba(139, 157, 131, 0.3);
            border-color: rgba(139, 157, 131, 0.5);
        }
        .sync-btn .user-avatar {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.5);
        }

        /* Sync Modal */
        .sync-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .sync-modal-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            max-width: 380px;
            width: 90%;
            position: relative;
            text-align: center;
        }
        .sync-modal h2 {
            color: var(--terracotta);
            margin-bottom: 1rem;
            font-family: 'Cormorant Garamond', serif;
        }
        .sync-modal p {
            color: var(--text-medium);
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }
        .sync-note {
            font-size: 0.75rem !important;
            color: var(--text-light) !important;
            margin-top: 1rem !important;
        }
        .google-signin-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            background: white;
            border: 1px solid #ddd;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            color: #333;
        }
        .google-signin-btn:hover {
            background: #f5f5f5;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--cream);
            border-radius: 10px;
            margin-bottom: 1rem;
        }
        .user-photo {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid var(--terracotta);
        }
        .user-details {
            text-align: left;
        }
        .user-name {
            display: block;
            font-weight: 600;
            color: var(--text-dark);
        }
        .user-email {
            display: block;
            font-size: 0.75rem;
            color: var(--text-light);
        }
        .sync-status {
            padding: 0.75rem;
            background: rgba(139, 157, 131, 0.15);
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        .sync-status #syncStatusText {
            display: block;
            font-weight: 600;
            color: var(--sage-dark);
        }
        .last-sync {
            font-size: 0.7rem;
            color: var(--text-light);
        }
        .sync-actions {
            display: flex;
            gap: 0.5rem;
        }
        .sync-actions .btn {
            flex: 1;
        }

        .instagram-link {
            display: none;
        }

        /* Desktop: show Instagram */
        @media (min-width: 769px) {
            .instagram-link {
                display: flex;
                align-items: center;
                gap: 0.3rem;
                color: white;
                text-decoration: none;
                font-size: 0.7rem;
                opacity: 0.85;
                transition: opacity 0.2s;
            }
            .instagram-link:hover { opacity: 1; }
            .instagram-link svg { width: 16px; height: 16px; }
        }

        /* Mobile header adjustments */
        @media (max-width: 480px) {
            .header {
                padding: 0.4rem 0.75rem;
                justify-content: space-between;
            }
            .header h1 {
                font-size: 0.95rem;
            }
            .header-center {
                order: 3;
                width: 100%;
                justify-content: center;
                margin-left: 0;
                padding-top: 0.25rem;
                border-top: 1px solid rgba(255,255,255,0.2);
                margin-top: 0.25rem;
            }
            .install-btn {
                padding: 0.3rem 0.5rem;
                font-size: 0.65rem;
            }
        }

        /* Install Modal */
        .install-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .install-modal-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            position: relative;
            text-align: center;
        }
        .install-modal h2 {
            color: var(--terracotta);
            margin-bottom: 0.5rem;
        }
        .install-modal p {
            color: var(--text-medium);
            margin-bottom: 1.5rem;
        }
        .install-instructions {
            text-align: left;
            background: var(--cream);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
        }
        .instruction-group {
            margin-bottom: 1rem;
        }
        .instruction-group:last-child {
            margin-bottom: 0;
        }
        .instruction-group h3 {
            font-size: 0.9rem;
            color: var(--brown);
            margin-bottom: 0.25rem;
        }
        .instruction-group p {
            font-size: 0.85rem;
            margin: 0;
        }
        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }
        .got-it-btn {
            background: var(--terracotta);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }
        .got-it-btn:hover {
            background: var(--terracotta-dark);
        }

        /* Layout */
        .main-container {
            display: flex;
            height: calc(100vh - 38px);
        }

        /* Left Panel */
        .collection-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--white);
        }

        .toolbar {
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid var(--cream-dark);
            display: flex;
            gap: 0.4rem;
            align-items: center;
            background: var(--cream);
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 150px;
            max-width: 220px;
            padding: 0.4rem 0.65rem;
            border: 1px solid var(--cream-dark);
            border-radius: 5px;
            font-size: 0.8rem;
            background: white;
        }
        .search-input:focus {
            outline: none;
            border-color: var(--terracotta);
        }

        .filter-btn {
            padding: 0.35rem 0.65rem;
            border: none;
            background: white;
            border-radius: 5px;
            font-size: 0.7rem;
            cursor: pointer;
            color: var(--text-medium);
            transition: all 0.15s;
        }
        .filter-btn:hover { background: var(--cream-dark); }
        .filter-btn.active {
            background: var(--terracotta);
            color: white;
        }

        .thread-grid {
            flex: 1;
            overflow-y: auto;
            padding: 0.4rem;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 0.3rem;
            align-content: start;
        }

        .thread-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.35rem 0.6rem;
            background: var(--cream);
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.15s;
        }
        .thread-item:hover { background: var(--cream-dark); }
        .thread-item.checked {
            background: var(--sage);
            color: white;
        }

        .thread-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--taupe);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            background: white;
        }
        .thread-item.checked .thread-checkbox {
            background: white;
            border-color: white;
        }
        .thread-checkbox svg {
            width: 12px;
            height: 12px;
            display: none;
        }
        .thread-item.checked .thread-checkbox svg {
            display: block;
            color: var(--sage);
        }

        .color-swatch {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: 1px solid rgba(0,0,0,0.15);
            flex-shrink: 0;
        }

        .thread-item.checked .color-swatch {
            border-color: rgba(255,255,255,0.4);
        }

        .thread-number {
            font-weight: 700;
            min-width: 45px;
        }

        .thread-name {
            flex: 1;
            opacity: 0.85;
            font-size: 0.75rem;
        }

        .qty-badge {
            background: rgba(255,255,255,0.4);
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            min-width: 28px;
            text-align: center;
        }
        .thread-item:not(.checked) .qty-badge {
            background: var(--cream-dark);
            color: var(--text-light);
        }
        .thread-item.checked .qty-badge {
            background: rgba(255,255,255,0.3);
        }

        .qty-controls {
            display: flex;
            align-items: center;
            gap: 0.2rem;
        }

        .qty-btn {
            width: 22px;
            height: 22px;
            border: none;
            background: rgba(255,255,255,0.5);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-medium);
        }
        .thread-item.checked .qty-btn {
            background: rgba(255,255,255,0.25);
            color: white;
        }
        .qty-btn:hover {
            background: rgba(255,255,255,0.7);
        }

        /* Right Panel */
        .pattern-panel {
            width: 340px;
            display: flex;
            flex-direction: column;
            background: var(--white);
            border-left: 1px solid var(--cream-dark);
        }

        .panel-tabs {
            display: flex;
            border-bottom: 1px solid var(--cream-dark);
        }

        .panel-tab {
            flex: 1;
            padding: 0.6rem;
            border: none;
            background: var(--cream);
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-medium);
            transition: all 0.15s;
        }
        .panel-tab:hover { background: var(--cream-dark); }
        .panel-tab.active {
            background: var(--white);
            color: var(--terracotta);
            border-bottom: 2px solid var(--terracotta);
        }

        .tab-content {
            display: none;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
        }
        .tab-content.active {
            display: flex;
        }

        .input-area {
            padding: 0.65rem;
            border-bottom: 1px solid var(--cream-dark);
        }

        .input-area label {
            display: block;
            font-size: 0.7rem;
            color: var(--text-light);
            margin-bottom: 0.3rem;
        }

        .pattern-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--cream-dark);
            border-radius: 5px;
            font-size: 0.85rem;
            font-family: inherit;
            resize: none;
            height: 60px;
        }
        .pattern-input:focus {
            outline: none;
            border-color: var(--terracotta);
        }

        .color-search-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--cream-dark);
            border-radius: 5px;
            font-size: 0.85rem;
        }
        .color-search-input:focus {
            outline: none;
            border-color: var(--terracotta);
        }

        .results-area {
            flex: 1;
            overflow-y: auto;
            padding: 0.65rem;
        }

        .result-group {
            margin-bottom: 0.85rem;
        }

        .result-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-medium);
            margin-bottom: 0.4rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        .dot.green { background: var(--sage); }
        .dot.orange { background: var(--terracotta); }
        .dot.blue { background: #5B8DB8; }

        .thread-list {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .thread-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.6rem;
            border-radius: 5px;
            font-size: 0.8rem;
        }
        .thread-row.owned {
            background: rgba(139, 157, 131, 0.15);
        }
        .thread-row.needed {
            background: rgba(198, 123, 92, 0.15);
        }
        .thread-row .mini-swatch {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            border: 1px solid rgba(0,0,0,0.1);
            flex-shrink: 0;
        }
        .thread-row .number {
            font-weight: 700;
            min-width: 45px;
        }
        .thread-row .name {
            flex: 1;
            color: var(--text-medium);
            font-size: 0.75rem;
        }
        
        /* Substitution Suggestions - Inline */
        .thread-row.needed {
            flex-wrap: wrap;
        }
        .thread-row.needed.has-substitute {
            padding-bottom: 0.4rem;
        }
        .inline-substitute {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            margin-top: 0.35rem;
            padding: 0.3rem 0.5rem;
            background: linear-gradient(135deg, rgba(139, 157, 131, 0.15) 0%, rgba(91, 141, 184, 0.1) 100%);
            border-radius: 6px;
            font-size: 0.7rem;
        }
        .inline-substitute .sub-hint {
            font-size: 0.8rem;
        }
        .inline-substitute .sub-text {
            color: var(--text-light);
        }
        .inline-substitute .sub-num {
            font-weight: 600;
            color: var(--sage-dark);
        }
        .inline-substitute .sub-percent {
            margin-left: auto;
            font-size: 0.6rem;
            font-weight: 600;
            color: white;
            background: var(--sage);
            padding: 0.1rem 0.35rem;
            border-radius: 8px;
        }
        .no-substitute {
            margin-left: auto;
        }
        .no-sub-text {
            font-size: 0.6rem;
            color: var(--text-light);
            font-style: italic;
            opacity: 0.7;
        }
        
        /* Summary Section */
        .summary-section {
            margin-top: 0.75rem;
            padding: 0.6rem;
            background: linear-gradient(135deg, var(--cream) 0%, var(--cream-dark) 100%);
            border-radius: 8px;
            border: 1px solid var(--cream-dark);
        }
        .summary-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.4rem;
        }
        .summary-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        .stat-item {
            font-size: 0.7rem;
            color: var(--text-medium);
        }
        .stat-item strong {
            color: var(--text-dark);
        }

        /* Old substitution group - kept for compatibility */
        .substitution-group {
            background: linear-gradient(135deg, rgba(91, 141, 184, 0.08) 0%, rgba(139, 157, 131, 0.08) 100%);
            border-radius: 8px;
            padding: 0.5rem;
            margin-top: 0.5rem;
        }
        .substitution-group .result-title {
            color: #3D6B8C;
        }
        .substitution-group .dot.blue {
            background: #5B8DB8;
        }
        .substitution-note {
            font-size: 0.7rem;
            color: var(--text-light);
            margin-bottom: 0.4rem;
            font-style: italic;
        }
        .thread-row.substitution {
            background: rgba(255,255,255,0.7);
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.5rem 0.6rem;
        }
        .sub-pair {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        .sub-arrow {
            color: var(--sage);
            font-weight: 600;
            font-size: 0.9rem;
        }
        .sub-match {
            margin-left: auto;
            font-size: 0.65rem;
            font-weight: 600;
            color: white;
            background: var(--sage);
            padding: 0.15rem 0.4rem;
            border-radius: 10px;
        }
        .substitution-disclaimer {
            font-size: 0.6rem;
            color: var(--text-light);
            text-align: center;
            margin-top: 0.4rem;
            opacity: 0.8;
        }

        .empty-state {
            text-align: center;
            padding: 1.5rem;
            color: var(--taupe);
            font-size: 0.85rem;
            line-height: 1.6;
        }

        /* Similar Color Result */
        .similar-result {
            background: var(--cream);
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .similar-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.6rem;
        }

        .similar-header .swatch {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            border: 1px solid rgba(0,0,0,0.15);
        }

        .similar-header .info {
            flex: 1;
        }

        .similar-header .number {
            font-weight: 700;
            font-size: 0.95rem;
        }

        .similar-header .name {
            font-size: 0.7rem;
            color: var(--text-light);
        }

        .similar-header .status {
            font-size: 0.65rem;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-weight: 600;
        }

        .similar-header .status.owned {
            background: var(--sage);
            color: white;
        }

        .similar-header .status.not-owned {
            background: var(--taupe);
            color: white;
        }

        .similar-list-title {
            font-size: 0.7rem;
            color: var(--text-light);
            margin-bottom: 0.4rem;
        }

        .similar-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem;
        }

        .similar-tag {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            background: rgba(91, 141, 184, 0.12);
            color: #3D6B8C;
            cursor: pointer;
        }
        .similar-tag:hover {
            background: rgba(91, 141, 184, 0.22);
        }
        .similar-tag .mini-swatch {
            width: 14px;
            height: 14px;
            border-radius: 2px;
            border: 1px solid rgba(0,0,0,0.1);
        }
        .similar-tag.has-it {
            background: rgba(139, 157, 131, 0.2);
            color: var(--sage-dark);
        }

        /* File Import */
        .file-import {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 0.5rem;
        }
        .file-import-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.5rem 0.75rem;
            background: var(--cream);
            border: 1px dashed var(--taupe);
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-medium);
            cursor: pointer;
            transition: all 0.2s;
        }
        .file-import-btn:hover {
            background: var(--cream-dark);
            border-color: var(--terracotta);
            color: var(--terracotta);
        }
        .file-hint {
            font-size: 0.65rem;
            color: var(--text-light);
            font-style: italic;
        }

        .actions {
            padding: 0.6rem;
            border-top: 1px solid var(--cream-dark);
            display: flex;
            gap: 0.4rem;
        }

        .btn {
            flex: 1;
            padding: 0.55rem;
            border: none;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.3rem;
            transition: all 0.15s;
        }
        .btn svg { width: 15px; height: 15px; }
        .btn-primary {
            background: var(--terracotta);
            color: white;
        }
        .btn-primary:hover { background: var(--terracotta-dark); }
        .btn-secondary {
            background: var(--cream);
            color: var(--text-medium);
        }
        .btn-secondary:hover { background: var(--cream-dark); }

        /* Promo Banner & Email Signup */
        .promo-banner {
            padding: 0.75rem;
            background: linear-gradient(135deg, var(--cream) 0%, var(--cream-dark) 100%);
            border-top: 1px solid var(--cream-dark);
        }

        .email-signup {
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .signup-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-medium);
            margin-bottom: 0.5rem;
        }

        .signup-form {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .signup-form .form-row {
            display: flex;
            gap: 0.3rem;
        }

        .signup-form input[type="email"] {
            flex: 1;
            padding: 0.45rem 0.6rem;
            border: 1px solid var(--cream-dark);
            border-radius: 5px;
            font-size: 0.8rem;
            background: white;
        }
        .signup-form input[type="email"]:focus {
            outline: none;
            border-color: var(--terracotta);
        }

        .signup-form button {
            padding: 0.45rem 0.8rem;
            background: var(--terracotta);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.15s;
        }
        .signup-form button:hover {
            background: var(--terracotta-dark);
        }

        .gdpr-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 0.4rem;
            text-align: left;
            cursor: pointer;
        }

        .gdpr-checkbox input[type="checkbox"] {
            margin-top: 2px;
            width: 14px;
            height: 14px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .gdpr-checkbox span {
            font-size: 0.6rem;
            color: var(--text-light);
            line-height: 1.3;
        }

        .gdpr-checkbox a {
            color: var(--terracotta);
            text-decoration: underline;
        }

        .signup-note {
            font-size: 0.6rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .shop-link {
            display: block;
            text-align: center;
            font-size: 0.7rem;
            color: var(--terracotta);
            font-weight: 600;
            text-decoration: none;
            padding-top: 0.4rem;
            border-top: 1px solid rgba(0,0,0,0.05);
            margin-top: 0.5rem;
        }
        .shop-link:hover {
            text-decoration: underline;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--brown);
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            font-size: 0.85rem;
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Print Styles */
        @media print {
            body { background: white !important; }
            .header, .collection-panel, .panel-tabs, .promo-banner, .actions, .input-area { 
                display: none !important; 
            }
            .main-container { display: block !important; height: auto !important; }
            .pattern-panel { 
                width: 100% !important; 
                border: none !important; 
                box-shadow: none !important;
            }
            .tab-content { display: flex !important; }
            .results-area { 
                overflow: visible !important; 
                padding: 0 !important;
            }
        }

        /* Mobile */
        @media (max-width: 768px) {
            .main-container { flex-direction: column; }
            .pattern-panel { 
                width: 100%; 
                height: 50vh;
                border-left: none;
                border-top: 2px solid var(--cream-dark);
            }
            .collection-panel { height: 50vh; }
            .thread-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }

        /* Print Preview Modal */
        .print-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .print-modal.show {
            display: flex;
        }
        .print-content {
            background: white;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .print-header {
            background: linear-gradient(135deg, var(--terracotta) 0%, var(--terracotta-dark) 100%);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .print-header h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3rem;
        }
        .print-header .date {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        .print-body {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }
        .print-section {
            margin-bottom: 1.5rem;
        }
        .print-section-title {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--cream);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .print-section-title.needed { color: var(--terracotta); }
        .print-section-title.owned { color: var(--sage-dark); }
        .print-thread {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--cream);
        }
        .print-thread .swatch {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 1px solid rgba(0,0,0,0.15);
            flex-shrink: 0;
        }
        .print-thread .number {
            font-weight: 700;
            min-width: 50px;
        }
        .print-thread .name {
            flex: 1;
            color: var(--text-medium);
        }
        .print-thread .qty-input {
            width: 50px;
            padding: 0.3rem;
            border: 1px solid var(--cream-dark);
            border-radius: 4px;
            text-align: center;
            font-size: 0.85rem;
        }
        .print-thread .qty-label {
            font-size: 0.75rem;
            color: var(--text-light);
        }
        .print-footer {
            padding: 1rem 1.5rem;
            background: var(--cream);
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }
        .print-footer .btn {
            flex: none;
            padding: 0.6rem 1.5rem;
        }
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.8;
        }
        .close-btn:hover { opacity: 1; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <a href="index.html" class="home-link" title="Back to Home">
                <img src="logo.png" alt="Needle Treasures Nook" class="header-logo">
            </a>
            <h1>DMC Inventory Tool</h1>
        </div>
        <div class="header-center">
            <div>Owned: <span id="ownedCount">0</span></div>
            <div>Skeins: <span id="skeinCount">0</span></div>
        </div>
        <div class="header-right">
            <button id="syncBtn" class="sync-btn" onclick="openSyncModal()" title="Cloud Sync">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12a9 9 0 11-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>
                    <path d="M21 3v5h-5"/>
                </svg>
                <span>Sync</span>
            </button>
            <button id="installBtn" class="install-btn" title="Add to Home Screen">Install</button>
            <a href="https://www.instagram.com/needletreasuresnook" target="_blank" class="instagram-link">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                </svg>
            </a>
        </div>
    </header>

    <!-- Install Instructions Modal -->
    <div id="installModal" class="install-modal" style="display:none;">
        <div class="install-modal-content">
            <button class="close-modal" onclick="closeInstallModal()">Ã—</button>
            <h2>ðŸ“² Install DMC Inventory Tool</h2>
            <p>Add this app to your home screen for quick access and offline use!</p>
            <div class="install-instructions">
                <div class="instruction-group">
                    <h3>ðŸ“± iPhone/iPad:</h3>
                    <p>Tap <strong>Share</strong> â†’ <strong>Add to Home Screen</strong></p>
                </div>
                <div class="instruction-group">
                    <h3>ðŸ¤– Android:</h3>
                    <p>Tap <strong>â‹® Menu</strong> â†’ <strong>Add to Home Screen</strong></p>
                </div>
                <div class="instruction-group">
                    <h3>ðŸ’» Desktop Chrome:</h3>
                    <p>Click <strong>â‹® Menu</strong> â†’ <strong>Install DMC Inventory Tool</strong></p>
                </div>
            </div>
            <button class="got-it-btn" onclick="closeInstallModal()">Got it!</button>
        </div>
    </div>

    <div class="main-container">
        <div class="collection-panel">
            <div class="toolbar">
                <input type="text" class="search-input" id="searchInput" placeholder="Search threads...">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="owned">Owned</button>
                <button class="filter-btn" data-filter="needed">Need</button>
            </div>
            <div class="thread-grid" id="threadGrid"></div>
        </div>

        <div class="pattern-panel">
            <div class="panel-tabs">
                <button class="panel-tab active" data-tab="checker">ðŸ›’ Pattern Checker</button>
                <button class="panel-tab" data-tab="similar">ðŸŽ¨ Find Similar</button>
            </div>

            <!-- Pattern Checker Tab -->
            <div class="tab-content active" id="checkerTab">
                <div class="input-area">
                    <label>Paste thread numbers or import from file:</label>
                    <textarea class="pattern-input" id="patternInput" placeholder="310, 321, 3801, blanc, ecru..."></textarea>
                    <div class="file-import">
                        <label for="fileInput" class="file-import-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            Import from file (.pdf, .txt, .csv)
                        </label>
                        <input type="file" id="fileInput" accept=".pdf,.txt,.csv" style="display:none;" onchange="importFromFile(event)">
                        <span class="file-hint">Upload your pattern PDF</span>
                    </div>
                </div>
                <div class="results-area" id="resultsArea">
                    <div class="empty-state">
                        Enter thread numbers to see<br>what you have vs. need to buy
                    </div>
                </div>
                <div class="actions">
                    <button class="btn btn-secondary" onclick="copyList()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        Copy
                    </button>
                    <button class="btn btn-primary" onclick="openPrintModal()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 6,2 18,2 18,9"></polyline>
                            <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                            <rect x="6" y="14" width="12" height="8"></rect>
                        </svg>
                        Print / PDF
                    </button>
                </div>
            </div>

            <!-- Find Similar Tab -->
            <div class="tab-content" id="similarTab">
                <div class="input-area">
                    <label>Enter a DMC number to find similar colors:</label>
                    <input type="text" class="color-search-input" id="colorSearchInput" placeholder="e.g. 310, 321, 3801...">
                </div>
                <div class="results-area" id="similarResults">
                    <div class="empty-state">
                        Ran out of a thread?<br>Find the closest alternatives!
                    </div>
                </div>
            </div>

            <div class="promo-banner">
                <div class="email-signup" id="emailSignup">
                    <p class="signup-title">ðŸ“§ Get free patterns & stitching tips!</p>
                    <form class="signup-form" action="https://assets.mailerlite.com/jsonp/2010016/forms/175294884076324104/subscribe" method="post" target="_blank">
                        <div class="form-row">
                            <input type="email" name="fields[email]" placeholder="Your email" required>
                            <button type="submit">Join</button>
                        </div>
                        <label class="gdpr-checkbox">
                            <input type="checkbox" name="gdpr_consent" required>
                            <span>I agree to receive emails and accept the <a href="https://needletreasuresnook.etsy.com/policy/privacy" target="_blank">Privacy Policy</a></span>
                        </label>
                        <input type="hidden" name="ml-submit" value="1">
                        <input type="hidden" name="anticsrf" value="true">
                    </form>
                    <p class="signup-note">No spam â€¢ Unsubscribe anytime</p>
                </div>
                <a href="https://needletreasuresnook.etsy.com" target="_blank" class="shop-link">Visit my Etsy shop â†’</a>
            </div>
        </div>
    </div>

    <!-- Print Modal -->
    <div class="print-modal" id="printModal">
        <div class="print-content">
            <div class="print-header">
                <div>
                    <h2>ðŸ§µ Shopping List</h2>
                    <div class="date" id="printDate"></div>
                </div>
                <button class="close-btn" onclick="closePrintModal()">Ã—</button>
            </div>
            <div class="print-body" id="printBody">
                <!-- Content generated by JS -->
            </div>
            <div class="print-footer">
                <button class="btn btn-secondary" onclick="closePrintModal()">Cancel</button>
                <button class="btn btn-primary" onclick="doPrint()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6,9 6,2 18,2 18,9"></polyline>
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                        <rect x="6" y="14" width="12" height="8"></rect>
                    </svg>
                    Print / Save PDF
                </button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <!-- Sync Modal -->
    <div class="sync-modal" id="syncModal" style="display:none;">
        <div class="sync-modal-content">
            <button class="close-modal" onclick="closeSyncModal()">&times;</button>
            <h2>Cloud Sync</h2>
            
            <div id="syncLoggedOut">
                <p>Sync your thread collection across all your devices. Sign in with Google to enable cloud backup.</p>
                <button class="google-signin-btn" onclick="signInWithGoogle()">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Sign in with Google
                </button>
                <p class="sync-note">Your data stays private and secure</p>
            </div>
            
            <div id="syncLoggedIn" style="display:none;">
                <div class="user-info">
                    <img id="userPhoto" src="" alt="Profile" class="user-photo">
                    <div class="user-details">
                        <span id="userName" class="user-name"></span>
                        <span id="userEmail" class="user-email"></span>
                    </div>
                </div>
                <div class="sync-status">
                    <span id="syncStatusText">Synced</span>
                    <span id="lastSyncTime" class="last-sync"></span>
                </div>
                <div class="sync-actions">
                    <button class="btn btn-primary" onclick="manualSync()">Sync Now</button>
                    <button class="btn btn-secondary" onclick="signOutUser()">Sign Out</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DMC Thread Database with HEX colors
        const DMC_THREADS = [
            ["BLANC", "White", "#FFFFFF"],
            ["ECRU", "Ecru", "#F0EAD6"],
            ["B5200", "Snow White", "#FFFFFF"],
            ["01", "White Tin", "#D5D5D5"],
            ["02", "Tin", "#C0C0C0"],
            ["03", "Tin Medium", "#A8A8A8"],
            ["04", "Tin Dark", "#909090"],
            ["05", "Light Driftwood", "#EDE4DA"],
            ["06", "Medium Light Driftwood", "#D8CCBC"],
            ["07", "Driftwood", "#C3B49C"],
            ["08", "Dark Driftwood", "#A89880"],
            ["09", "Very Dark Driftwood", "#8C7C64"],
            ["10", "Tender Green Vy Lt", "#E0EACC"],
            ["11", "Tender Green Light", "#CADEA8"],
            ["12", "Tender Green", "#B4D284"],
            ["13", "Nile Green Med Lt", "#B8D4AC"],
            ["14", "Apple Green Pale", "#E0F0D4"],
            ["15", "Apple Green", "#C0E0A8"],
            ["16", "Chartreuse Lt", "#E8F4C8"],
            ["17", "Yellow Plum Lt", "#F4E8B4"],
            ["18", "Yellow Plum", "#E8D48C"],
            ["19", "Autumn Gold Med Lt", "#E0C890"],
            ["20", "Shrimp", "#F8D0BC"],
            ["21", "Light Alizarin", "#F0B8A0"],
            ["22", "Alizarin", "#E8A088"],
            ["23", "Apple Blossom Lt", "#F4DCE0"],
            ["24", "Apple Blossom", "#E8C4CC"],
            ["25", "Pale Orchid Vy Lt", "#F0DCE8"],
            ["26", "Pale Orchid Light", "#E4C8D8"],
            ["27", "Pale Orchid", "#D8B4C8"],
            ["28", "Etoile Gray Lt", "#D8D0D8"],
            ["29", "Etoile Gray", "#C4B8C4"],
            ["30", "Pale Violet Med Lt", "#D8C8D8"],
            ["31", "Blueberry Vy Lt", "#D4D4E4"],
            ["32", "Blueberry Light", "#C0C0D4"],
            ["33", "Blueberry", "#A8A8C0"],
            ["34", "Blueberry Med", "#9090AC"],
            ["35", "Very Dark Dusty Rose", "#A06070"],
            ["150", "Dusty Rose Vy Dk", "#AB4D6C"],
            ["151", "Dusty Rose Vy Lt", "#F0CED4"],
            ["152", "Shell Pink Med Lt", "#E2A099"],
            ["153", "Violet Very Light", "#E6CEE3"],
            ["154", "Grape Very Dark", "#572433"],
            ["155", "Blue Violet Med Dk", "#9891BA"],
            ["156", "Blue Violet Med Lt", "#A3A4CE"],
            ["157", "Cornflower Bl Vy Lt", "#BBC3D9"],
            ["158", "Cornflower Med Vy Dk", "#4C526E"],
            ["159", "Blue Gray Light", "#C7CBD9"],
            ["160", "Blue Gray Medium", "#999FB5"],
            ["161", "Blue Gray", "#7780A0"],
            ["162", "Blue Ultra Vy Lt", "#DBECF6"],
            ["163", "Celadon Green Med", "#4D997A"],
            ["164", "Forest Green Lt", "#C8D9B3"],
            ["165", "Moss Green Vy Lt", "#EFF3C2"],
            ["166", "Moss Green Med Lt", "#C0C840"],
            ["167", "Yellow Beige Vy Dk", "#A77B40"],
            ["168", "Pewter Very Light", "#D1D1D1"],
            ["169", "Pewter Light", "#848484"],
            ["208", "Lavender Vy Dk", "#835B94"],
            ["209", "Lavender Dark", "#A47FB3"],
            ["210", "Lavender Medium", "#C3A0C9"],
            ["211", "Lavender Light", "#E3D0E6"],
            ["221", "Shell Pink Vy Dk", "#883E43"],
            ["223", "Shell Pink Light", "#CC8484"],
            ["224", "Shell Pink Vy Lt", "#EBB9B5"],
            ["225", "Shell Pink Ult Vy Lt", "#FFE8E3"],
            ["300", "Mahogany Vy Dk", "#6F2B1C"],
            ["301", "Mahogany Medium", "#B35C39"],
            ["304", "Christmas Red Med", "#B72327"],
            ["307", "Lemon", "#FDEE4D"],
            ["309", "Rose Dark", "#BA4364"],
            ["310", "Black", "#000000"],
            ["311", "Navy Blue Med", "#1C4566"],
            ["312", "Navy Blue Light", "#2E5B82"],
            ["315", "Antique Mauve Vy Dk", "#814953"],
            ["316", "Antique Mauve Med", "#B87A82"],
            ["317", "Pewter Gray", "#6C6C6C"],
            ["318", "Steel Gray Light", "#A6A6A6"],
            ["319", "Pistachio Grn Vy Dk", "#205D3B"],
            ["320", "Pistachio Green Med", "#6B9362"],
            ["321", "Christmas Red", "#C72B35"],
            ["322", "Navy Blue Vy Lt", "#5B8CBE"],
            ["326", "Rose Very Dark", "#B3374B"],
            ["327", "Violet Dark", "#633970"],
            ["333", "Blue Violet Vy Dk", "#5C5478"],
            ["334", "Baby Blue Medium", "#739EC4"],
            ["335", "Rose", "#E95F7A"],
            ["336", "Navy Blue", "#253B6A"],
            ["340", "Blue Violet Med", "#AD9EC6"],
            ["341", "Blue Violet Light", "#B7B7D8"],
            ["347", "Salmon Very Dark", "#BF2D2D"],
            ["349", "Coral Dark", "#D22D35"],
            ["350", "Coral Medium", "#E04848"],
            ["351", "Coral", "#E96A67"],
            ["352", "Coral Light", "#FD9583"],
            ["353", "Peach", "#FEC5B4"],
            ["355", "Terra Cotta Dk", "#984937"],
            ["356", "Terra Cotta Med", "#C56B55"],
            ["367", "Pistachio Green Dk", "#61805A"],
            ["368", "Pistachio Green Lt", "#A6C89B"],
            ["369", "Pistachio Grn Vy Lt", "#D5ECC7"],
            ["370", "Mustard Medium", "#B88B4D"],
            ["371", "Mustard", "#BF9958"],
            ["372", "Mustard Light", "#CCA85F"],
            ["400", "Mahogany Dark", "#8C4931"],
            ["402", "Mahogany Vy Lt", "#F6A76A"],
            ["407", "Desert Sand Dk", "#B87D68"],
            ["413", "Pewter Gray Dark", "#5A5A5A"],
            ["414", "Steel Gray Dark", "#8C8C8C"],
            ["415", "Pearl Gray", "#D0D0D0"],
            ["420", "Hazelnut Brown Dk", "#A0713D"],
            ["422", "Hazelnut Brown Lt", "#C69C6D"],
            ["433", "Brown Medium", "#7A4A26"],
            ["434", "Brown Light", "#98642C"],
            ["435", "Brown Very Light", "#B8793E"],
            ["436", "Tan", "#CB9858"],
            ["437", "Tan Light", "#DDB97C"],
            ["444", "Lemon Dark", "#FFD600"],
            ["445", "Lemon Light", "#FFFFA0"],
            ["451", "Shell Gray Dark", "#908584"],
            ["452", "Shell Gray Med", "#B5A9A8"],
            ["453", "Shell Gray Lt", "#CBC2C0"],
            ["469", "Avocado Green", "#72843C"],
            ["470", "Avocado Green Lt", "#94A75A"],
            ["471", "Avocado Green Vy Lt", "#AEC27F"],
            ["472", "Avocado Grn Ult Lt", "#D6E9A6"],
            ["498", "Christmas Red Dk", "#A72025"],
            ["500", "Blue Green Vy Dk", "#044D45"],
            ["501", "Blue Green Dark", "#3B7368"],
            ["502", "Blue Green", "#5C9188"],
            ["503", "Blue Green Med", "#7BAD9F"],
            ["504", "Blue Green Vy Lt", "#C2D9CB"],
            ["505", "Jade Green", "#33826A"],
            ["517", "Wedgewood Dark", "#3B788F"],
            ["518", "Wedgewood Light", "#5FA0AF"],
            ["519", "Sky Blue", "#7FC0D5"],
            ["520", "Fern Green Dark", "#666B45"],
            ["522", "Fern Green", "#989F7A"],
            ["523", "Fern Green Light", "#ABB08E"],
            ["524", "Fern Green Vy Lt", "#C4C8AC"],
            ["535", "Ash Gray Vy Lt", "#636363"],
            ["543", "Beige Brown Ult Vy Lt", "#F3E6DA"],
            ["550", "Violet Very Dark", "#5C2C61"],
            ["552", "Violet Medium", "#803C8C"],
            ["553", "Violet", "#A356A4"],
            ["554", "Violet Light", "#D9A6DC"],
            ["561", "Jade Very Dark", "#2C6E5F"],
            ["562", "Jade Medium", "#538F7C"],
            ["563", "Jade Light", "#8FC5AB"],
            ["564", "Jade Very Light", "#C6E1CC"],
            ["580", "Moss Green Dark", "#888E36"],
            ["581", "Moss Green", "#A7AC4B"],
            ["597", "Turquoise", "#5BB4BF"],
            ["598", "Turquoise Light", "#90D5D6"],
            ["600", "Cranberry Vy Dk", "#CD2F62"],
            ["601", "Cranberry Dark", "#D1416E"],
            ["602", "Cranberry Med", "#E25884"],
            ["603", "Cranberry", "#FF7BA9"],
            ["604", "Cranberry Light", "#FF9FC2"],
            ["605", "Cranberry Vy Lt", "#FFBBD5"],
            ["606", "Bright Orange Red", "#FA400B"],
            ["608", "Bright Orange", "#FD6A02"],
            ["610", "Drab Brown Vy Dk", "#796248"],
            ["611", "Drab Brown Dark", "#967B5D"],
            ["612", "Drab Brown Med", "#BC9D7D"],
            ["613", "Drab Brown Light", "#D6C3AB"],
            ["632", "Desert Sand Ult Vy Dk", "#8E5642"],
            ["640", "Beige Gray Vy Dk", "#857F72"],
            ["642", "Beige Gray Dark", "#A39A8B"],
            ["644", "Beige Gray Med", "#DDD6CB"],
            ["645", "Beaver Gray Vy Dk", "#696969"],
            ["646", "Beaver Gray Dark", "#858585"],
            ["647", "Beaver Gray Med", "#9F9F9F"],
            ["648", "Beaver Gray Light", "#B8B8B8"],
            ["666", "Christmas Red Bright", "#E31D2E"],
            ["676", "Old Gold Light", "#E4C878"],
            ["677", "Old Gold Vy Lt", "#F5E6B0"],
            ["680", "Old Gold Dark", "#BC8A26"],
            ["699", "Christmas Green", "#056317"],
            ["700", "Christmas Green Bright", "#078C27"],
            ["701", "Christmas Green Lt", "#3F9F44"],
            ["702", "Kelly Green", "#47A747"],
            ["703", "Chartreuse", "#7EBF5F"],
            ["704", "Chartreuse Bright", "#9ECF43"],
            ["712", "Cream", "#FBF7E7"],
            ["718", "Plum", "#9C2D72"],
            ["720", "Orange Spice Dk", "#E55C20"],
            ["721", "Orange Spice Med", "#F27842"],
            ["722", "Orange Spice Lt", "#F7976D"],
            ["725", "Topaz", "#FFC840"],
            ["726", "Topaz Light", "#FEDA6B"],
            ["727", "Topaz Very Light", "#FFF1A8"],
            ["728", "Topaz Golden", "#E4B732"],
            ["729", "Old Gold Medium", "#D0A23A"],
            ["730", "Olive Green Vy Dk", "#827A28"],
            ["731", "Olive Green Dk", "#918531"],
            ["732", "Olive Green", "#9C8E38"],
            ["733", "Olive Green Med", "#BCA73C"],
            ["734", "Olive Green Lt", "#C7B561"],
            ["738", "Tan Very Light", "#ECCDAB"],
            ["739", "Tan Ultra Vy Lt", "#F5E3CD"],
            ["740", "Tangerine", "#FF8313"],
            ["741", "Tangerine Med", "#FFA041"],
            ["742", "Tangerine Light", "#FFBF6C"],
            ["743", "Yellow Medium", "#FED557"],
            ["744", "Yellow Pale", "#FFE793"],
            ["745", "Yellow Light Pale", "#FFF4BA"],
            ["746", "Off White", "#FCFAF1"],
            ["747", "Sky Blue Vy Lt", "#E5F5F8"],
            ["754", "Peach Light", "#F4C8B4"],
            ["758", "Terra Cotta Vy Lt", "#EEB59E"],
            ["760", "Salmon", "#F5A4A0"],
            ["761", "Salmon Light", "#FFC9C6"],
            ["762", "Pearl Gray Vy Lt", "#E8E8E8"],
            ["772", "Yellow Green Vy Lt", "#E1EFA7"],
            ["775", "Baby Blue Vy Lt", "#D0E8F7"],
            ["776", "Pink Medium", "#FCB5BC"],
            ["777", "Raspberry Vy Dk", "#912B51"],
            ["778", "Antique Mauve Vy Lt", "#DFB9BA"],
            ["779", "Cocoa Dark", "#6B4E3E"],
            ["780", "Topaz Ult Vy Dk", "#945B00"],
            ["781", "Topaz Very Dark", "#A76700"],
            ["782", "Topaz Dark", "#B97A12"],
            ["783", "Topaz Medium", "#CE9329"],
            ["791", "Cornflower Blue Vy Dk", "#464F79"],
            ["792", "Cornflower Blue Dk", "#555F8C"],
            ["793", "Cornflower Blue Med", "#707BA4"],
            ["794", "Cornflower Blue Lt", "#8F9BC6"],
            ["796", "Royal Blue Dark", "#1A3480"],
            ["797", "Royal Blue", "#1E4299"],
            ["798", "Delft Blue Dark", "#4672AC"],
            ["799", "Delft Blue Med", "#6B94C6"],
            ["800", "Delft Blue Pale", "#C0D6ED"],
            ["801", "Coffee Brown Dk", "#5D3417"],
            ["806", "Peacock Blue Dk", "#3D8B8B"],
            ["807", "Peacock Blue", "#64A8A4"],
            ["809", "Delft Blue", "#94B8D8"],
            ["813", "Blue Light", "#A1C4E3"],
            ["814", "Garnet Dark", "#7B2131"],
            ["815", "Garnet Medium", "#872C3A"],
            ["816", "Garnet", "#973843"],
            ["817", "Coral Red Vy Dk", "#BB2219"],
            ["818", "Baby Pink", "#FFDFD8"],
            ["819", "Baby Pink Light", "#FFE7E4"],
            ["820", "Royal Blue Vy Dk", "#0F2366"],
            ["822", "Beige Gray Light", "#E6DFD4"],
            ["823", "Navy Blue Dark", "#0E1C4B"],
            ["824", "Blue Very Dark", "#1F4680"],
            ["825", "Blue Dark", "#2D5B9A"],
            ["826", "Blue Medium", "#3D73B3"],
            ["827", "Blue Very Light", "#B4D3E8"],
            ["828", "Blue Ult Vy Lt", "#C6E3F1"],
            ["829", "Golden Olive Vy Dk", "#7E6008"],
            ["830", "Golden Olive Dk", "#8C6E11"],
            ["831", "Golden Olive Med", "#A4811F"],
            ["832", "Golden Olive", "#B28E22"],
            ["833", "Golden Olive Lt", "#C2A02F"],
            ["834", "Golden Olive Vy Lt", "#D4B54C"],
            ["838", "Beige Brown Vy Dk", "#5C4128"],
            ["839", "Beige Brown Dk", "#70503A"],
            ["840", "Beige Brown Med", "#9A7C5F"],
            ["841", "Beige Brown Lt", "#B99E82"],
            ["842", "Beige Brown Vy Lt", "#D4C4AF"],
            ["844", "Beaver Gray Ult Dk", "#525252"],
            ["868", "Hazelnut Brn Vy Dk", "#986C3C"],
            ["869", "Hazelnut Brown Dk", "#8F5F30"],
            ["890", "Pistachio Grn Ult Dk", "#174827"],
            ["891", "Carnation Dark", "#FF6271"],
            ["892", "Carnation Med", "#FF758A"],
            ["893", "Carnation Light", "#FC8DA5"],
            ["894", "Carnation Vy Lt", "#FFB4C1"],
            ["895", "Hunter Green Vy Dk", "#1B4125"],
            ["898", "Coffee Brown Vy Dk", "#492813"],
            ["899", "Rose Medium", "#F27688"],
            ["900", "Burnt Orange Dk", "#D65116"],
            ["902", "Garnet Very Dark", "#6A1C2B"],
            ["904", "Parrot Green Vy Dk", "#557A24"],
            ["905", "Parrot Green Dk", "#6A8E28"],
            ["906", "Parrot Green Med", "#82A62B"],
            ["907", "Parrot Green Lt", "#C3DF5B"],
            ["909", "Emerald Green Vy Dk", "#157A3A"],
            ["910", "Emerald Green Dk", "#188B46"],
            ["911", "Emerald Green Med", "#189A58"],
            ["912", "Emerald Green Lt", "#1BAA6B"],
            ["913", "Nile Green Med", "#6DC294"],
            ["915", "Plum Dark", "#820B49"],
            ["917", "Plum Medium", "#9B166B"],
            ["918", "Red Copper Dark", "#823024"],
            ["919", "Red Copper", "#A64B32"],
            ["920", "Copper Medium", "#AB5339"],
            ["921", "Copper", "#C66D42"],
            ["922", "Copper Light", "#E08155"],
            ["924", "Gray Green Vy Dk", "#566C67"],
            ["926", "Gray Green Med", "#98B1A8"],
            ["927", "Gray Green Light", "#BDD0C7"],
            ["928", "Gray Green Vy Lt", "#DDE8E4"],
            ["930", "Antique Blue Dk", "#455C7A"],
            ["931", "Antique Blue Med", "#6A839E"],
            ["932", "Antique Blue Lt", "#A2B6CA"],
            ["934", "Black Avocado Grn", "#3E4B2E"],
            ["935", "Avocado Green Dk", "#424C2F"],
            ["936", "Avocado Green Vy Dk", "#4C5532"],
            ["937", "Avocado Green Med", "#62733E"],
            ["938", "Coffee Brown Ult Dk", "#3D230E"],
            ["939", "Navy Blue Vy Dk", "#1B2C50"],
            ["943", "Aquamarine Med", "#3DB6A8"],
            ["945", "Tawny", "#FACCAB"],
            ["946", "Burnt Orange Med", "#EB6113"],
            ["947", "Burnt Orange", "#FF7B31"],
            ["948", "Peach Very Light", "#FEE9DD"],
            ["950", "Desert Sand Lt", "#EDD0BB"],
            ["951", "Tawny Light", "#FFE2CA"],
            ["954", "Nile Green", "#88C9A4"],
            ["955", "Nile Green Light", "#B1E1C2"],
            ["956", "Geranium", "#FF6D7D"],
            ["957", "Geranium Pale", "#FF9FAC"],
            ["958", "Sea Green Dark", "#3EB4A5"],
            ["959", "Sea Green Med", "#59CABB"],
            ["961", "Dusty Rose Dark", "#CF7A7E"],
            ["962", "Dusty Rose Med", "#E68F94"],
            ["963", "Dusty Rose Ult Vy Lt", "#FFDBD8"],
            ["964", "Sea Green Light", "#A9E5D9"],
            ["966", "Baby Green Med", "#B9DCC2"],
            ["967", "Apricot Very Lt", "#FFD3C3"],
            ["970", "Pumpkin Light", "#F78B14"],
            ["971", "Pumpkin", "#F67600"],
            ["972", "Canary Deep", "#FFB800"],
            ["973", "Canary Bright", "#FFE200"],
            ["975", "Golden Brown Dk", "#914F15"],
            ["976", "Golden Brown Med", "#C07728"],
            ["977", "Golden Brown Lt", "#DC9F4B"],
            ["986", "Forest Green Vy Dk", "#405226"],
            ["987", "Forest Green Dk", "#587238"],
            ["988", "Forest Green Med", "#739B4B"],
            ["989", "Forest Green", "#8BBB5D"],
            ["991", "Aquamarine Dk", "#478E86"],
            ["992", "Aquamarine Lt", "#6FC5B8"],
            ["993", "Aquamarine Vy Lt", "#90D5C9"],
            ["995", "Electric Blue Dk", "#266AAB"],
            ["996", "Electric Blue Med", "#3CADE8"],
            ["3011", "Khaki Green Dk", "#8A8C5B"],
            ["3012", "Khaki Green Med", "#A5A773"],
            ["3013", "Khaki Green Lt", "#B9BB8E"],
            ["3021", "Brown Gray Vy Dk", "#544A3F"],
            ["3022", "Brown Gray Med", "#8E8477"],
            ["3023", "Brown Gray Lt", "#B3AB9D"],
            ["3024", "Brown Gray Vy Lt", "#EBE8E3"],
            ["3031", "Mocha Brown Vy Dk", "#4B392A"],
            ["3032", "Mocha Brown Med", "#B09D84"],
            ["3033", "Mocha Brown Vy Lt", "#E3D6C6"],
            ["3041", "Antique Violet Med", "#9A7F97"],
            ["3042", "Antique Violet Lt", "#B8A3B5"],
            ["3045", "Yellow Beige Dk", "#BC955B"],
            ["3046", "Yellow Beige Med", "#D5B984"],
            ["3047", "Yellow Beige Lt", "#E7DBC0"],
            ["3051", "Green Gray Dark", "#5F6A4C"],
            ["3052", "Green Gray Med", "#889B6F"],
            ["3053", "Green Gray", "#9BAB85"],
            ["3064", "Desert Sand", "#C79C7D"],
            ["3072", "Beaver Gray Vy Lt", "#E0E0E0"],
            ["3078", "Golden Yellow Vy Lt", "#FFF6C2"],
            ["3325", "Baby Blue Light", "#B8D4E9"],
            ["3326", "Rose Light", "#FBB4B6"],
            ["3328", "Salmon Dark", "#E36D70"],
            ["3340", "Apricot Medium", "#FF8566"],
            ["3341", "Apricot", "#FC9D83"],
            ["3345", "Hunter Green Dk", "#1B5228"],
            ["3346", "Hunter Green", "#406F3E"],
            ["3347", "Yellow Green Med", "#71924C"],
            ["3348", "Yellow Green Lt", "#CCE09B"],
            ["3350", "Dusty Rose Ult Dk", "#BC4365"],
            ["3354", "Dusty Rose Lt", "#E5A3A1"],
            ["3362", "Pine Green Dark", "#5E6E49"],
            ["3363", "Pine Green Med", "#728959"],
            ["3364", "Pine Green", "#83986A"],
            ["3371", "Black Brown", "#1E110A"],
            ["3607", "Plum Light", "#C34A90"],
            ["3608", "Plum Very Light", "#EA97C5"],
            ["3609", "Plum Ultra Light", "#F4C7DD"],
            ["3685", "Mauve Very Dark", "#883A51"],
            ["3687", "Mauve", "#C76B80"],
            ["3688", "Mauve Medium", "#DC9BA7"],
            ["3689", "Mauve Light", "#FBC6CC"],
            ["3705", "Melon Dark", "#FF6A79"],
            ["3706", "Melon Medium", "#FF8A95"],
            ["3708", "Melon Light", "#FFCDD5"],
            ["3712", "Salmon Medium", "#F2847E"],
            ["3713", "Salmon Very Lt", "#FFE1DE"],
            ["3716", "Dusty Rose Med Vy Lt", "#FFBCBD"],
            ["3721", "Shell Pink Dk", "#A14F56"],
            ["3722", "Shell Pink Med", "#BC6465"],
            ["3726", "Antique Mauve Dk", "#9C5B62"],
            ["3727", "Antique Mauve Lt", "#DBA9A9"],
            ["3731", "Dusty Rose Vy Dk", "#C8647C"],
            ["3733", "Dusty Rose", "#E89396"],
            ["3740", "Antique Violet Dk", "#786171"],
            ["3743", "Antique Violet Vy Lt", "#D7CAD6"],
            ["3746", "Blue Violet Dk", "#776E9F"],
            ["3747", "Blue Violet Vy Lt", "#D6D6EB"],
            ["3750", "Antique Blue Vy Dk", "#384C60"],
            ["3752", "Antique Blue Vy Lt", "#C4D2DF"],
            ["3753", "Antique Blue Ult Vy Lt", "#DBE6EE"],
            ["3755", "Baby Blue", "#939FC9"],
            ["3756", "Baby Blue Ult Vy Lt", "#EEFBFF"],
            ["3760", "Wedgewood Med", "#3E8FAA"],
            ["3761", "Sky Blue Light", "#ACD8E5"],
            ["3765", "Peacock Blue Vy Dk", "#348282"],
            ["3766", "Peacock Blue Lt", "#99D3CF"],
            ["3768", "Gray Green Dk", "#657E78"],
            ["3770", "Tawny Very Lt", "#FFECDB"],
            ["3771", "Terra Cotta Ult Vy Lt", "#F4C4A9"],
            ["3772", "Desert Sand Vy Dk", "#A0715C"],
            ["3773", "Desert Sand Med", "#D9A58C"],
            ["3774", "Desert Sand Vy Lt", "#F5E3D8"],
            ["3776", "Mahogany Light", "#CF7339"],
            ["3777", "Terra Cotta Vy Dk", "#863123"],
            ["3778", "Terra Cotta Lt", "#D99175"],
            ["3779", "Terra Cotta Ult Vy Lt", "#F8CDB9"],
            ["3781", "Mocha Brown Dk", "#6B4F3D"],
            ["3782", "Mocha Brown Lt", "#D0BDA5"],
            ["3787", "Brown Gray Dk", "#6E635A"],
            ["3790", "Beige Gray Ult Dk", "#6E5E52"],
            ["3799", "Pewter Gray Vy Dk", "#474747"],
            ["3801", "Melon Very Dk", "#E7455F"],
            ["3802", "Antique Mauve Vy Dk", "#6E3841"],
            ["3803", "Mauve Dark", "#8E2F52"],
            ["3804", "Cyclamen Pink Dk", "#D23179"],
            ["3805", "Cyclamen Pink", "#F33E93"],
            ["3806", "Cyclamen Pink Lt", "#FF7ABE"],
            ["3807", "Cornflower Blue", "#607AAC"],
            ["3808", "Turquoise Ult Vy Dk", "#366A69"],
            ["3809", "Turquoise Vy Dk", "#3F807A"],
            ["3810", "Turquoise Dark", "#489B96"],
            ["3811", "Turquoise Vy Lt", "#BCE3E1"],
            ["3812", "Sea Green Vy Dk", "#2F9D8F"],
            ["3813", "Blue Green Lt", "#B8D6C8"],
            ["3814", "Aquamarine", "#509289"],
            ["3815", "Celadon Green Dk", "#478061"],
            ["3816", "Celadon Green", "#659878"],
            ["3817", "Celadon Green Lt", "#99BFA3"],
            ["3818", "Emerald Grn Ult Vy Dk", "#116531"],
            ["3819", "Moss Green Lt", "#E0EC91"],
            ["3820", "Straw Dark", "#DFB342"],
            ["3821", "Straw", "#F3C95C"],
            ["3822", "Straw Light", "#F6DC8F"],
            ["3823", "Yellow Ultra Pale", "#FFFDD5"],
            ["3824", "Apricot Light", "#FEC5AB"],
            ["3825", "Pumpkin Pale", "#FDB173"],
            ["3826", "Golden Brown", "#AD6E2C"],
            ["3827", "Golden Brown Pale", "#F7BA70"],
            ["3828", "Hazelnut Brown", "#B5864E"],
            ["3829", "Old Gold Vy Dk", "#AA7B10"],
            ["3830", "Terra Cotta", "#BC6545"],
            ["3831", "Raspberry Dk", "#B42E56"],
            ["3832", "Raspberry Med", "#DB516F"],
            ["3833", "Raspberry Lt", "#EA8895"],
            ["3834", "Grape Dark", "#723963"],
            ["3835", "Grape Medium", "#945F8C"],
            ["3836", "Grape Light", "#BA94B1"],
            ["3837", "Lavender Ult Dk", "#6C3A78"],
            ["3838", "Lavender Blue Dk", "#5C6DA4"],
            ["3839", "Lavender Blue Med", "#7B8DBE"],
            ["3840", "Lavender Blue Lt", "#B1BEE0"],
            ["3841", "Baby Blue Pale", "#CDDDEE"],
            ["3842", "Wedgewood Vy Dk", "#2B6078"],
            ["3843", "Electric Blue", "#17B6DC"],
            ["3844", "Turquoise Bright Dk", "#12A2AE"],
            ["3845", "Turquoise Bright Med", "#4AC4CB"],
            ["3846", "Turquoise Bright Lt", "#95E7E8"],
            ["3847", "Teal Green Dk", "#347975"],
            ["3848", "Teal Green Med", "#559490"],
            ["3849", "Teal Green Lt", "#52B3A3"],
            ["3850", "Bright Green Dk", "#388C6C"],
            ["3851", "Bright Green Lt", "#49B896"],
            ["3852", "Straw Very Dk", "#CD9C25"],
            ["3853", "Autumn Gold Dk", "#F29341"],
            ["3854", "Autumn Gold Med", "#F2AB66"],
            ["3855", "Autumn Gold Lt", "#FAD197"],
            ["3856", "Mahogany Ult Vy Lt", "#FFD3AF"],
            ["3857", "Rosewood Dk", "#6C3731"],
            ["3858", "Rosewood Med", "#964942"],
            ["3859", "Rosewood Lt", "#BA8178"],
            ["3860", "Cocoa", "#8E6B60"],
            ["3861", "Cocoa Light", "#AC9087"],
            ["3862", "Mocha Beige Dk", "#8A6C4F"],
            ["3863", "Mocha Beige Med", "#AB9175"],
            ["3864", "Mocha Beige Lt", "#CBB99E"],
            ["3865", "Winter White", "#F8F8F5"],
            ["3866", "Mocha Brown Ult Vy Lt", "#FAF5EF"]
        ];

        // State
        let myCollection = new Map();
        let currentFilter = 'all';
        let searchQuery = '';
        let neededList = [];
        let ownedList = [];

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            loadCollection();
            renderThreads();
            updateStats();
            setupListeners();
        });

        function loadCollection() {
            const saved = localStorage.getItem('dmc_collection');
            if (saved) {
                try {
                    myCollection = new Map(Object.entries(JSON.parse(saved)));
                } catch(e) {}
            }
        }

        function saveCollection() {
            localStorage.setItem('dmc_collection', JSON.stringify(Object.fromEntries(myCollection)));
        }

        function setupListeners() {
            document.getElementById('searchInput').addEventListener('input', e => {
                searchQuery = e.target.value.toLowerCase();
                renderThreads();
            });

            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    renderThreads();
                });
            });

            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab + 'Tab').classList.add('active');
                });
            });

            document.getElementById('patternInput').addEventListener('input', checkPattern);
            document.getElementById('colorSearchInput').addEventListener('input', findSimilar);
        }

        function getThreadByNumber(num) {
            const normalized = num.toUpperCase().replace(/^0+/, '');
            return DMC_THREADS.find(t => 
                t[0] === num || t[0] === normalized || t[0].replace(/^0+/, '') === normalized
            );
        }

        function renderThreads() {
            const grid = document.getElementById('threadGrid');
            
            const filtered = DMC_THREADS.filter(t => {
                const match = t[0].toLowerCase().includes(searchQuery) || t[1].toLowerCase().includes(searchQuery);
                if (!match) return false;
                if (currentFilter === 'owned') return myCollection.has(t[0]);
                if (currentFilter === 'needed') return !myCollection.has(t[0]);
                return true;
            });

            grid.innerHTML = filtered.map(t => {
                const owned = myCollection.has(t[0]);
                const qty = myCollection.get(t[0]) || 0;

                return `
                    <div class="thread-item ${owned ? 'checked' : ''}" onclick="toggleThread('${t[0]}', event)">
                        <div class="thread-checkbox">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </div>
                        <div class="color-swatch" style="background-color: ${t[2]}"></div>
                        <span class="thread-number">${t[0]}</span>
                        <span class="thread-name">${t[1]}</span>
                        <div class="qty-controls" onclick="event.stopPropagation()">
                            <button class="qty-btn" onclick="changeQty('${t[0]}', -1)">âˆ’</button>
                            <span class="qty-badge">${qty}</span>
                            <button class="qty-btn" onclick="changeQty('${t[0]}', 1)">+</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleThread(num, event) {
            if (event.target.closest('.qty-controls')) return;
            
            if (myCollection.has(num)) {
                myCollection.delete(num);
            } else {
                myCollection.set(num, 1);
            }
            
            saveCollection();
            updateStats();
            renderThreads();
            checkPattern();
        }

        function changeQty(num, delta) {
            const current = myCollection.get(num) || 0;
            const newQty = Math.max(0, current + delta);
            
            if (newQty === 0) {
                myCollection.delete(num);
            } else {
                myCollection.set(num, newQty);
            }
            
            saveCollection();
            updateStats();
            renderThreads();
            checkPattern();
        }

        function updateStats() {
            document.getElementById('ownedCount').textContent = myCollection.size;
            const total = Array.from(myCollection.values()).reduce((a, b) => a + b, 0);
            document.getElementById('skeinCount').textContent = total;
        }

        function checkPattern() {
            const input = document.getElementById('patternInput').value;
            const area = document.getElementById('resultsArea');

            if (!input.trim()) {
                area.innerHTML = '<div class="empty-state">Enter thread numbers to see<br>what you have vs. need to buy</div>';
                neededList = [];
                ownedList = [];
                return;
            }

            const nums = [...new Set(
                input.toUpperCase().split(/[\s,;]+/).map(n => n.trim()).filter(n => n)
            )];

            ownedList = [];
            neededList = [];

            nums.forEach(n => {
                const thread = getThreadByNumber(n);
                if (thread) {
                    if (myCollection.has(thread[0])) {
                        ownedList.push(thread);
                    } else {
                        neededList.push(thread);
                    }
                }
            });

            let html = '';
            
            // Find all possible substitutions first
            const substitutionMap = new Map();
            if (myCollection.size > 0) {
                neededList.forEach(needed => {
                    const sub = findBestSubstitute(needed);
                    if (sub) {
                        substitutionMap.set(needed[0], sub);
                    }
                });
            }
            
            // Always show "Need to Buy" first if there are items
            if (neededList.length) {
                html += `<div class="result-group">
                    <div class="result-title"><span class="dot orange"></span> Need to Buy (${neededList.length})</div>
                    <div class="thread-list">
                        ${neededList.map(t => {
                            const sub = substitutionMap.get(t[0]);
                            return `
                            <div class="thread-row needed ${sub ? 'has-substitute' : ''}">
                                <span class="mini-swatch" style="background: ${t[2]}"></span>
                                <span class="number">${t[0]}</span>
                                <span class="name">${t[1]}</span>
                                ${sub ? `
                                <div class="inline-substitute" title="You have a similar color in your collection">
                                    <span class="sub-hint">ðŸ’¡</span>
                                    <span class="sub-text">or use</span>
                                    <span class="mini-swatch" style="background: ${sub.thread[2]}"></span>
                                    <span class="sub-num">${sub.thread[0]}</span>
                                    <span class="sub-percent">${sub.matchPercent}%</span>
                                </div>
                                ` : `
                                <div class="no-substitute">
                                    <span class="no-sub-text">no similar in stash</span>
                                </div>
                                `}
                            </div>
                        `}).join('')}
                    </div>
                </div>`;
            }
            
            // Then show "You Have"
            if (ownedList.length) {
                html += `<div class="result-group">
                    <div class="result-title"><span class="dot green"></span> You Have (${ownedList.length})</div>
                    <div class="thread-list">
                        ${ownedList.map(t => `
                            <div class="thread-row owned">
                                <span class="mini-swatch" style="background: ${t[2]}"></span>
                                <span class="number">${t[0]}</span>
                                <span class="name">${t[1]}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>`;
            }
            
            // Summary section
            if (neededList.length > 0) {
                const withSubs = Array.from(substitutionMap.keys()).length;
                const mustBuy = neededList.length - withSubs;
                html += `<div class="summary-section">
                    <div class="summary-title">ðŸ“‹ Summary</div>
                    <div class="summary-stats">
                        <span class="stat-item">âœ… Have: <strong>${ownedList.length}</strong></span>
                        <span class="stat-item">ðŸ›’ Must buy: <strong>${mustBuy}</strong></span>
                        ${withSubs > 0 ? `<span class="stat-item">ðŸ’¡ Can substitute: <strong>${withSubs}</strong></span>` : ''}
                    </div>
                </div>`;
            }
            
            area.innerHTML = html || '<div class="empty-state">No valid DMC numbers found</div>';
        }
        
        // Find best substitute from user's collection for a single thread
        function findBestSubstitute(needed) {
            // Delta E thresholds:
            // 0-1: Not perceptible by human eye
            // 1-2: Perceptible through close observation
            // 2-10: Perceptible at a glance
            // 11-49: Colors are more similar than opposite
            // 100: Colors are exactly opposite
            
            const maxDeltaE = 5; // Only suggest very similar colors (was 15)
            let bestMatch = null;
            let bestDistance = Infinity;
            
            myCollection.forEach((qty, num) => {
                const owned = getThreadByNumber(num);
                if (owned) {
                    const distance = colorDistance(needed[2], owned[2]);
                    if (distance < bestDistance && distance < maxDeltaE) {
                        bestDistance = distance;
                        bestMatch = owned;
                    }
                }
            });
            
            if (bestMatch) {
                // Convert Delta E to percentage
                // 0 = 100% match, 5 = 90% match (stricter threshold)
                const matchPercent = Math.round(100 - (bestDistance / maxDeltaE) * 10);
                // Only return if 90% or higher match
                if (matchPercent >= 90) {
                    return {
                        thread: bestMatch,
                        distance: bestDistance,
                        matchPercent: Math.min(99, matchPercent)
                    };
                }
            }
            return null;
        }
        
        // Find substitutions from user's collection (kept for compatibility)
        function findSubstitutionsFromCollection(neededThreads) {
            const substitutions = [];
            neededThreads.forEach(needed => {
                const sub = findBestSubstitute(needed);
                if (sub) {
                    substitutions.push({
                        needed: needed,
                        substitute: sub.thread,
                        distance: sub.distance,
                        matchPercent: sub.matchPercent
                    });
                }
            });
            return substitutions.sort((a, b) => a.distance - b.distance);
        }

        // Color distance calculation using Delta E CIE2000
        // This is the industry standard for perceptual color difference
        
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }
        
        // Convert RGB to LAB color space
        function rgbToLab(rgb) {
            // First convert RGB to XYZ
            let r = rgb.r / 255;
            let g = rgb.g / 255;
            let b = rgb.b / 255;
            
            // Apply gamma correction
            r = r > 0.04045 ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92;
            g = g > 0.04045 ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92;
            b = b > 0.04045 ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92;
            
            r *= 100; g *= 100; b *= 100;
            
            // RGB to XYZ (D65 illuminant)
            const x = r * 0.4124564 + g * 0.3575761 + b * 0.1804375;
            const y = r * 0.2126729 + g * 0.7151522 + b * 0.0721750;
            const z = r * 0.0193339 + g * 0.1191920 + b * 0.9503041;
            
            // XYZ to LAB
            const refX = 95.047, refY = 100.000, refZ = 108.883;
            
            let labX = x / refX;
            let labY = y / refY;
            let labZ = z / refZ;
            
            labX = labX > 0.008856 ? Math.pow(labX, 1/3) : (7.787 * labX) + (16/116);
            labY = labY > 0.008856 ? Math.pow(labY, 1/3) : (7.787 * labY) + (16/116);
            labZ = labZ > 0.008856 ? Math.pow(labZ, 1/3) : (7.787 * labZ) + (16/116);
            
            return {
                L: (116 * labY) - 16,
                a: 500 * (labX - labY),
                b: 200 * (labY - labZ)
            };
        }
        
        // Delta E CIE2000 - Industry standard color difference
        function deltaE2000(hex1, hex2) {
            const rgb1 = hexToRgb(hex1);
            const rgb2 = hexToRgb(hex2);
            if (!rgb1 || !rgb2) return Infinity;
            
            const lab1 = rgbToLab(rgb1);
            const lab2 = rgbToLab(rgb2);
            
            const L1 = lab1.L, a1 = lab1.a, b1 = lab1.b;
            const L2 = lab2.L, a2 = lab2.a, b2 = lab2.b;
            
            // Calculate C and h
            const C1 = Math.sqrt(a1 * a1 + b1 * b1);
            const C2 = Math.sqrt(a2 * a2 + b2 * b2);
            const Cab = (C1 + C2) / 2;
            
            const G = 0.5 * (1 - Math.sqrt(Math.pow(Cab, 7) / (Math.pow(Cab, 7) + Math.pow(25, 7))));
            
            const a1p = a1 * (1 + G);
            const a2p = a2 * (1 + G);
            
            const C1p = Math.sqrt(a1p * a1p + b1 * b1);
            const C2p = Math.sqrt(a2p * a2p + b2 * b2);
            
            const h1p = Math.atan2(b1, a1p) * 180 / Math.PI + (b1 < 0 ? 360 : 0);
            const h2p = Math.atan2(b2, a2p) * 180 / Math.PI + (b2 < 0 ? 360 : 0);
            
            // Calculate deltas
            const dLp = L2 - L1;
            const dCp = C2p - C1p;
            
            let dhp;
            if (C1p * C2p === 0) {
                dhp = 0;
            } else if (Math.abs(h2p - h1p) <= 180) {
                dhp = h2p - h1p;
            } else if (h2p - h1p > 180) {
                dhp = h2p - h1p - 360;
            } else {
                dhp = h2p - h1p + 360;
            }
            
            const dHp = 2 * Math.sqrt(C1p * C2p) * Math.sin(dhp * Math.PI / 360);
            
            // Calculate CIEDE2000
            const Lp = (L1 + L2) / 2;
            const Cp = (C1p + C2p) / 2;
            
            let hp;
            if (C1p * C2p === 0) {
                hp = h1p + h2p;
            } else if (Math.abs(h1p - h2p) <= 180) {
                hp = (h1p + h2p) / 2;
            } else if (h1p + h2p < 360) {
                hp = (h1p + h2p + 360) / 2;
            } else {
                hp = (h1p + h2p - 360) / 2;
            }
            
            const T = 1 - 0.17 * Math.cos((hp - 30) * Math.PI / 180) +
                      0.24 * Math.cos(2 * hp * Math.PI / 180) +
                      0.32 * Math.cos((3 * hp + 6) * Math.PI / 180) -
                      0.20 * Math.cos((4 * hp - 63) * Math.PI / 180);
            
            const SL = 1 + (0.015 * Math.pow(Lp - 50, 2)) / Math.sqrt(20 + Math.pow(Lp - 50, 2));
            const SC = 1 + 0.045 * Cp;
            const SH = 1 + 0.015 * Cp * T;
            
            const RT = -2 * Math.sqrt(Math.pow(Cp, 7) / (Math.pow(Cp, 7) + Math.pow(25, 7))) *
                       Math.sin(60 * Math.exp(-Math.pow((hp - 275) / 25, 2)) * Math.PI / 180);
            
            const dE = Math.sqrt(
                Math.pow(dLp / SL, 2) +
                Math.pow(dCp / SC, 2) +
                Math.pow(dHp / SH, 2) +
                RT * (dCp / SC) * (dHp / SH)
            );
            
            return dE;
        }
        
        // Wrapper function for color distance (uses Delta E 2000)
        function colorDistance(hex1, hex2) {
            return deltaE2000(hex1, hex2);
        }

        function findSimilarColors(threadNum, count = 6) {
            const thread = getThreadByNumber(threadNum);
            if (!thread) return [];
            
            const targetHex = thread[2];
            
            return DMC_THREADS
                .filter(t => t[0] !== thread[0])
                .map(t => ({
                    thread: t,
                    distance: colorDistance(targetHex, t[2])
                }))
                .sort((a, b) => a.distance - b.distance)
                .slice(0, count)
                .map(item => item.thread);
        }

        function findSimilar() {
            const input = document.getElementById('colorSearchInput').value.trim();
            const area = document.getElementById('similarResults');

            if (!input) {
                area.innerHTML = '<div class="empty-state">Ran out of a thread?<br>Find the closest alternatives!</div>';
                return;
            }

            const thread = getThreadByNumber(input);
            if (!thread) {
                area.innerHTML = '<div class="empty-state">Thread not found.<br>Try a valid DMC number.</div>';
                return;
            }

            const similar = findSimilarColors(input, 6);
            const isOwned = myCollection.has(thread[0]);

            let html = `
                <div class="similar-result">
                    <div class="similar-header">
                        <div class="swatch" style="background: ${thread[2]}"></div>
                        <div class="info">
                            <div class="number">${thread[0]}</div>
                            <div class="name">${thread[1]}</div>
                        </div>
                        <span class="status ${isOwned ? 'owned' : 'not-owned'}">${isOwned ? 'âœ“ Owned' : 'Not owned'}</span>
                    </div>
                    <div class="similar-list-title">Closest alternatives:</div>
                    <div class="similar-tags">
                        ${similar.map(t => {
                            const owned = myCollection.has(t[0]);
                            return `<span class="similar-tag ${owned ? 'has-it' : ''}" onclick="document.getElementById('colorSearchInput').value='${t[0]}';findSimilar();">
                                <span class="mini-swatch" style="background:${t[2]}"></span>
                                ${t[0]}${owned ? ' âœ“' : ''}
                            </span>`;
                        }).join('')}
                    </div>
                </div>
            `;

            // Show which similar colors user owns
            const ownedAlternatives = similar.filter(t => myCollection.has(t[0]));
            if (ownedAlternatives.length > 0 && !isOwned) {
                html += `
                    <div class="result-group" style="margin-top: 0.75rem;">
                        <div class="result-title"><span class="dot green"></span> You own these alternatives:</div>
                        <div class="thread-list">
                            ${ownedAlternatives.map(t => `
                                <div class="thread-row owned">
                                    <span class="mini-swatch" style="background:${t[2]}"></span>
                                    <span class="number">${t[0]}</span>
                                    <span class="name">${t[1]}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            area.innerHTML = html;
        }

        function copyList() {
            if (!neededList.length && !ownedList.length) return showToast('Enter pattern threads first');
            
            let text = 'DMC Shopping List\n';
            text += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
            
            if (neededList.length) {
                text += 'ðŸ›’ NEED TO BUY:\n';
                neededList.forEach(t => {
                    text += `  ${t[0]} - ${t[1]}\n`;
                });
                text += '\n';
            }
            
            if (ownedList.length) {
                text += 'âœ“ ALREADY HAVE:\n';
                ownedList.forEach(t => {
                    text += `  ${t[0]} - ${t[1]}\n`;
                });
            }
            
            text += '\nâ€” Needle Treasures Nook';
            
            navigator.clipboard.writeText(text).then(() => showToast('List copied!'));
        }

        // Print Modal Functions
        function openPrintModal() {
            if (!neededList.length && !ownedList.length) {
                return showToast('Enter pattern threads first');
            }

            const modal = document.getElementById('printModal');
            const body = document.getElementById('printBody');
            const dateEl = document.getElementById('printDate');
            
            dateEl.textContent = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', month: 'long', day: 'numeric' 
            });

            let html = '';

            if (neededList.length) {
                html += `
                    <div class="print-section">
                        <div class="print-section-title needed">
                            ðŸ›’ Need to Buy (${neededList.length})
                        </div>
                        ${neededList.map(t => `
                            <div class="print-thread">
                                <div class="swatch" style="background: ${t[2]}"></div>
                                <span class="number">${t[0]}</span>
                                <span class="name">${t[1]}</span>
                                <span class="qty-label">Qty:</span>
                                <input type="text" class="qty-input" value="1">
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            if (ownedList.length) {
                html += `
                    <div class="print-section">
                        <div class="print-section-title owned">
                            âœ“ Already Have (${ownedList.length})
                        </div>
                        ${ownedList.map(t => `
                            <div class="print-thread">
                                <div class="swatch" style="background: ${t[2]}"></div>
                                <span class="number">${t[0]}</span>
                                <span class="name">${t[1]}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            body.innerHTML = html;
            modal.classList.add('show');
        }

        function closePrintModal() {
            document.getElementById('printModal').classList.remove('show');
        }

        function doPrint() {
            const printContent = document.getElementById('printBody').innerHTML;
            const printDate = document.getElementById('printDate').textContent;
            
            const printWindow = document.createElement('iframe');
            printWindow.style.position = 'absolute';
            printWindow.style.top = '-10000px';
            printWindow.style.left = '-10000px';
            document.body.appendChild(printWindow);

            const doc = printWindow.contentDocument || printWindow.contentWindow.document;
            doc.open();
            doc.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Shopping List - Needle Treasures Nook</title>
                    <style>
                        body {
                            font-family: 'Segoe UI', Arial, sans-serif;
                            padding: 20px;
                            color: #333;
                            max-width: 800px;
                            margin: 0 auto;
                        }
                        .header {
                            background: linear-gradient(135deg, #C67B5C 0%, #A85D40 100%);
                            color: white;
                            padding: 15px 20px;
                            border-radius: 8px;
                            margin-bottom: 20px;
                        }
                        .header h1 {
                            margin: 0;
                            font-size: 20px;
                        }
                        .header .date {
                            font-size: 12px;
                            opacity: 0.9;
                            margin-top: 3px;
                        }
                        .print-section {
                            margin-bottom: 25px;
                        }
                        .print-section-title {
                            font-size: 14px;
                            font-weight: bold;
                            margin-bottom: 10px;
                            padding-bottom: 8px;
                            border-bottom: 2px solid #EDE6DA;
                        }
                        .print-section-title.needed { color: #C67B5C; }
                        .print-section-title.owned { color: #6F8066; }
                        .print-thread {
                            display: flex;
                            align-items: center;
                            gap: 10px;
                            padding: 8px 0;
                            border-bottom: 1px solid #F5F0E8;
                        }
                        .swatch {
                            width: 20px;
                            height: 20px;
                            border-radius: 3px;
                            border: 1px solid rgba(0,0,0,0.15);
                            -webkit-print-color-adjust: exact;
                            print-color-adjust: exact;
                        }
                        .number {
                            font-weight: bold;
                            min-width: 50px;
                        }
                        .name {
                            flex: 1;
                            color: #666;
                        }
                        .qty-label {
                            font-size: 12px;
                            color: #888;
                        }
                        .qty-input {
                            width: 40px;
                            height: 24px;
                            border: 1px solid #ccc;
                            border-radius: 3px;
                            text-align: center;
                        }
                        .footer {
                            margin-top: 20px;
                            padding-top: 15px;
                            border-top: 1px solid #EDE6DA;
                            text-align: center;
                            color: #7A6B5E;
                            font-size: 11px;
                        }
                        .footer a { 
                            color: #C67B5C; 
                            font-weight: 600;
                            text-decoration: none;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ðŸ§µ Shopping List</h1>
                        <div class="date">${printDate}</div>
                    </div>
                    ${printContent}
                    <div class="footer">
                        Created with DMC Inventory Tool by<br>
                        <a href="https://needletreasuresnook.etsy.com">Needle Treasures Nook</a>
                    </div>
                </body>
                </html>
            `);
            doc.close();

            printWindow.contentWindow.focus();
            setTimeout(() => {
                printWindow.contentWindow.print();
                setTimeout(() => {
                    document.body.removeChild(printWindow);
                }, 1000);
            }, 250);

            closePrintModal();
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        // Import from file (PDF, TXT, CSV)
        async function importFromFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const fileName = file.name.toLowerCase();
            let content = '';
            
            // Show loading state
            const fileBtn = document.querySelector('.file-import-btn');
            const originalText = fileBtn.innerHTML;
            fileBtn.innerHTML = 'â³ Processing...';
            
            try {
                if (fileName.endsWith('.pdf')) {
                    // Handle PDF files
                    content = await extractTextFromPDF(file);
                } else {
                    // Handle TXT and CSV files
                    content = await file.text();
                }
                
                // Extract DMC numbers from content
                const validNumbers = extractDMCNumbers(content);
                
                if (validNumbers.length > 0) {
                    // Add to textarea
                    const textarea = document.getElementById('patternInput');
                    const currentValue = textarea.value.trim();
                    const newValue = currentValue ? currentValue + ', ' + validNumbers.join(', ') : validNumbers.join(', ');
                    textarea.value = newValue;
                    
                    // Trigger the check
                    textarea.dispatchEvent(new Event('input'));
                    
                    alert(`âœ… Imported ${validNumbers.length} DMC numbers from ${file.name}`);
                } else {
                    alert('No valid DMC numbers found in file.\n\nMake sure the file contains DMC thread numbers (like 310, 321, blanc, ecru).');
                }
            } catch (error) {
                console.error('Error reading file:', error);
                alert('Error reading file. Please try a different file.');
            }
            
            // Restore button
            fileBtn.innerHTML = originalText;
            
            // Reset file input
            event.target.value = '';
        }
        
        // Extract text from PDF using PDF.js
        async function extractTextFromPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            
            // Set worker source
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
            
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let fullText = '';
            
            // Extract text from all pages
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ');
                fullText += pageText + ' ';
            }
            
            return fullText;
        }
        
        // Extract DMC numbers from text content
        function extractDMCNumbers(content) {
            let numbers = [];
            
            const normalizedContent = content.toUpperCase();
            
            // Pattern 1: Explicit DMC mentions (DMC 310, DMC-310, DMC#310) - MOST RELIABLE
            const dmcExplicit = normalizedContent.match(/DMC[\s\-#:]*0*(\d{1,4})/gi) || [];
            dmcExplicit.forEach(m => {
                const num = m.match(/\d{1,4}/);
                if (num) numbers.push(num[0]);
            });
            
            // If we found explicit DMC mentions, prefer those and skip other patterns
            // This avoids picking up random numbers from charts, page numbers, etc.
            if (numbers.length >= 3) {
                // We likely found the thread list, use only explicit DMC matches
                const specialMatches = content.match(/\b(blanc|ecru|b5200)\b/gi) || [];
                numbers = numbers.concat(specialMatches.map(s => s.toUpperCase()));
            } else {
                // Fallback: try other patterns if no explicit DMC found
                
                // Pattern 2: Standalone 3-4 digit numbers in valid DMC range
                const standalone = normalizedContent.match(/(?:^|[\s,;|(])(\d{3,4})(?:[\s,;|)]|$)/g) || [];
                standalone.forEach(m => {
                    const num = m.match(/\d{3,4}/);
                    if (num) numbers.push(num[0]);
                });
                
                // Find special color names
                const specialMatches = content.match(/\b(blanc|ecru|b5200)\b/gi) || [];
                numbers = numbers.concat(specialMatches.map(s => s.toUpperCase()));
            }
            
            // Valid DMC number ranges
            const isValidDMC = (num) => {
                const n = num.toString().replace(/^0+/, '') || '0';
                const intNum = parseInt(n);
                
                // Special colors
                if (['BLANC', 'ECRU', 'B5200'].includes(n.toUpperCase())) return true;
                
                // Exclude very small numbers (1, 2, 3) - too common as counts, page numbers
                if (intNum >= 1 && intNum <= 3) return false;
                
                // 04-35 range (DMC special colors)
                if (intNum >= 4 && intNum <= 35) return true;
                
                // Standard DMC ranges
                if (intNum >= 150 && intNum <= 169) return true;
                if (intNum >= 208 && intNum <= 211) return true;
                if (intNum >= 221 && intNum <= 225) return true;
                if (intNum >= 300 && intNum <= 372) return true;
                if (intNum >= 400 && intNum <= 453) return true;
                if (intNum >= 469 && intNum <= 472) return true;
                if (intNum >= 498 && intNum <= 504) return true;
                if (intNum >= 505 && intNum <= 989) return true;
                if (intNum >= 991 && intNum <= 3899) return true;
                
                return false;
            };
            
            // Filter and deduplicate
            const validNumbers = [...new Set(numbers)]
                .map(n => n.toString().replace(/^0+/, '') || '0')
                .filter(isValidDMC)
                .filter(n => {
                    const intNum = parseInt(n);
                    // Exclude years (2020-2030)
                    if (intNum >= 2020 && intNum <= 2030) return false;
                    // Exclude round numbers often used for other purposes
                    if ([1000, 2000, 3000, 100, 200, 500].includes(intNum)) return false;
                    return true;
                });
            
            return [...new Set(validNumbers)];
        }

        // Close modal on outside click
        document.getElementById('printModal').addEventListener('click', function(e) {
            if (e.target === this) closePrintModal();
        });
    </script>

    <!-- MailerLite Universal -->
    <script src="https://groot.mailerlite.com/js/w/webforms.min.js?v176e10baa5e7ed80d35ae235be3d5024" type="text/javascript"></script>
    <script>
        fetch("https://assets.mailerlite.com/jsonp/2010016/forms/175294884076324104/takel");
    </script>

    <!-- PWA Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.log('SW failed:', err));
            });
        }

        // PWA Install
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
            } else {
                // Show instructions modal
                document.getElementById('installModal').style.display = 'flex';
            }
        });

        function closeInstallModal() {
            document.getElementById('installModal').style.display = 'none';
        }

        window.addEventListener('appinstalled', () => {
            console.log('App installed');
        });
    </script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB488fuAqQfEjMmYeDRejYAv_ujnJmVQWw",
            authDomain: "needle-treasures-nook.firebaseapp.com",
            projectId: "needle-treasures-nook",
            storageBucket: "needle-treasures-nook.firebasestorage.app",
            messagingSenderId: "887463807128",
            appId: "1:887463807128:web:8d66ea3e68bc66e46c68ed"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        function openSyncModal() {
            document.getElementById('syncModal').style.display = 'flex';
        }
        
        function closeSyncModal() {
            document.getElementById('syncModal').style.display = 'none';
        }

        async function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                await auth.signInWithPopup(provider);
                showToast('Signed in successfully!');
            } catch (error) {
                console.error('Sign in error:', error);
                showToast('Sign in failed. Please try again.');
            }
        }

        async function signOutUser() {
            try {
                await auth.signOut();
                showToast('Signed out');
                updateSyncUI(null);
            } catch (error) {
                console.error('Sign out error:', error);
            }
        }

        async function saveToCloud(user) {
            if (!user) return;
            try {
                const data = {
                    collection: Object.fromEntries(myCollection),
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                };
                await db.collection('users').doc(user.uid).set(data, { merge: true });
                localStorage.setItem('lastCloudSync', new Date().toISOString());
                updateLastSyncTime(new Date());
            } catch (error) {
                console.error('Cloud save error:', error);
            }
        }

        async function loadFromCloud(user) {
            if (!user) return;
            try {
                const doc = await db.collection('users').doc(user.uid).get();
                if (doc.exists) {
                    const data = doc.data();
                    const cloudCollection = data.collection || {};
                    if (Object.keys(cloudCollection).length > 0) {
                        myCollection = new Map(Object.entries(cloudCollection));
                        saveCollection();
                        renderThreads();
                        updateStats();
                        showToast('Collection synced from cloud!');
                    }
                    localStorage.setItem('lastCloudSync', new Date().toISOString());
                    updateLastSyncTime(new Date());
                } else if (myCollection.size > 0) {
                    await saveToCloud(user);
                    showToast('Collection backed up to cloud!');
                }
            } catch (error) {
                console.error('Cloud load error:', error);
            }
        }

        async function manualSync() {
            const user = auth.currentUser;
            if (!user) return;
            document.getElementById('syncStatusText').textContent = 'Syncing...';
            try {
                await saveToCloud(user);
                document.getElementById('syncStatusText').textContent = 'Synced!';
                showToast('Synced successfully!');
            } catch (error) {
                document.getElementById('syncStatusText').textContent = 'Sync failed';
            }
        }

        function updateSyncUI(user) {
            const syncBtn = document.getElementById('syncBtn');
            const loggedOut = document.getElementById('syncLoggedOut');
            const loggedIn = document.getElementById('syncLoggedIn');
            
            if (user) {
                syncBtn.innerHTML = '<img src="' + (user.photoURL || '') + '" class="user-avatar" onerror="this.style.display=\'none\'"><span>Synced</span>';
                syncBtn.classList.add('synced');
                loggedOut.style.display = 'none';
                loggedIn.style.display = 'block';
                document.getElementById('userPhoto').src = user.photoURL || '';
                document.getElementById('userName').textContent = user.displayName || 'User';
                document.getElementById('userEmail').textContent = user.email || '';
                const lastSync = localStorage.getItem('lastCloudSync');
                if (lastSync) updateLastSyncTime(new Date(lastSync));
            } else {
                syncBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 11-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg><span>Sync</span>';
                syncBtn.classList.remove('synced');
                loggedOut.style.display = 'block';
                loggedIn.style.display = 'none';
            }
        }

        function updateLastSyncTime(date) {
            const el = document.getElementById('lastSyncTime');
            if (el && date) {
                const diff = Math.floor((new Date() - date) / 1000);
                let text = diff < 60 ? 'Just now' : diff < 3600 ? Math.floor(diff/60) + ' min ago' : date.toLocaleDateString();
                el.textContent = 'Last synced: ' + text;
            }
        }

        auth.onAuthStateChanged((user) => {
            updateSyncUI(user);
            if (user) loadFromCloud(user);
        });

        let cloudSyncTimeout;
        const originalSaveCollection = saveCollection;
        saveCollection = function() {
            originalSaveCollection();
            clearTimeout(cloudSyncTimeout);
            cloudSyncTimeout = setTimeout(() => {
                const user = auth.currentUser;
                if (user) saveToCloud(user);
            }, 5000);
        };

        document.getElementById('syncModal').addEventListener('click', function(e) {
            if (e.target === this) closeSyncModal();
        });
    </script>
</body>
</html>
