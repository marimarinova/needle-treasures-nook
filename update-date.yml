# .github/workflows/update-date.yml
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤—è–≤–∞ "Tools updated" –¥–∞—Ç–∞—Ç–∞ –≤—Å—è–∫–∞ —Å–µ–¥–º–∏—Ü–∞ (–ø–æ–Ω–µ–¥–µ–ª–Ω–∏–∫ 00:00 UTC)

name: Update Weekly Date

on:
  schedule:
    # –í—Å–µ–∫–∏ –ø–æ–Ω–µ–¥–µ–ª–Ω–∏–∫ –≤ 00:00 UTC
    - cron: '0 0 * * 1'
  # –ü–æ–∑–≤–æ–ª—è–≤–∞ —Ä—ä—á–Ω–æ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –æ—Ç GitHub UI
  workflow_dispatch:

jobs:
  update-date:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Update date in HTML files
        run: |
          # –§–æ—Ä–º–∞—Ç–∏—Ä–∞–π –¥–∞—Ç–∞—Ç–∞ –∫–∞—Ç–æ "January 13, 2026"
          NEW_DATE=$(date -u +"%B %d, %Y" | sed 's/ 0/ /')
          
          echo "Updating date to: $NEW_DATE"
          
          # –û–±–Ω–æ–≤–∏ index.html
          if [ -f "index.html" ]; then
            sed -i "s/<noscript>[A-Za-z]* [0-9]*, [0-9]*<\/noscript>/<noscript>$NEW_DATE<\/noscript>/g" index.html
            echo "Updated index.html"
          fi
          
          # –û–±–Ω–æ–≤–∏ dmc-anchor-conversion.html (–∞–∫–æ –∏–º–∞ noscript)
          if [ -f "dmc-anchor-conversion.html" ]; then
            sed -i "s/<noscript>[A-Za-z]* [0-9]*, [0-9]*<\/noscript>/<noscript>$NEW_DATE<\/noscript>/g" dmc-anchor-conversion.html
            echo "Updated dmc-anchor-conversion.html"
          fi
          
          # –û–±–Ω–æ–≤–∏ meta —Ç–∞–≥–∞ article:modified_time
          ISO_DATE=$(date -u +"%Y-%m-%dT00:00:00Z")
          
          for file in *.html; do
            if [ -f "$file" ]; then
              # –ê–∫–æ —Ñ–∞–π–ª—ä—Ç –∏–º–∞ article:modified_time, –æ–±–Ω–æ–≤–∏ –≥–æ
              if grep -q "article:modified_time" "$file"; then
                sed -i "s/content=\"[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\}T[0-9:]*Z*\"/content=\"$ISO_DATE\"/g" "$file"
                echo "Updated meta tag in $file"
              fi
            fi
          done
      
      - name: Commit and push changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ –∏–º–∞ –ø—Ä–æ–º–µ–Ω–∏
          if git diff --quiet; then
            echo "No changes to commit"
          else
            git add -A
            git commit -m "üîÑ Auto-update: Tools updated date [$(date -u +%Y-%m-%d)]"
            git push
            echo "Changes committed and pushed"
          fi
